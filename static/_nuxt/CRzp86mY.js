import{_ as O}from"./DsUbastd.js";import{_ as z}from"./B6iGa9ow.js";import{g as j,_ as G}from"./CsOSaYm2.js";import{_ as H}from"./BmxMjOzF.js";import{e as q,r as i,f as E,c as u,h as R,b as x,i as n,w as M,o as a,a as s,l as c,m as v,v as w,F as C,g as U,s as J,t as V,p as T,_ as F,x as Q,j as W}from"./D9zQjNKj.js";import{A as $}from"./BzSSBEFk.js";import{u as N}from"./CTY1i3uY.js";import"./B0Jj9cDs.js";const X={class:"activitySelector"},Y={class:"activities"},Z=["value"],tt=["value"],et=q({__name:"ActivitySelector",emits:["activityId"],setup(P,{expose:k,emit:S}){const r=j(14),d=i(localStorage.getItem("city")),_=i(null),f=i([]);function p(){new $("/api/activity").get({city:d.value}).then(A=>{f.value=A})}E(p);const l=i(""),g=i(null),m=i(""),y=i(""),o=i(r[0]?.beStr),b=i(r[0]?.beStr);function K(){new $("/api/activity").post({title:m.value,introduction:y.value,city:d.value,begin_time:o.value,end_time:b.value}).finally(()=>{p(),g.value.open=!1})}const I=i(null),L=S;function B(A){I.value=A,_.value.open=!1,L("activityId",I.value.id)}return k({setTargetActivity:B}),(A,e)=>{const h=G,D=H;return a(),u("div",X,[n(I)?(a(),R(h,{key:1,activity:n(I),onClick:e[1]||(e[1]=t=>n(_).open=!0)},null,8,["activity"])):(a(),u("div",{key:0,class:"empty",onClick:e[0]||(e[0]=t=>n(_).open=!0)},"添加活动")),x(D,{ref_key:"dialog",ref:_,height:"calc(100% - 100px)",class:"dialog"},{default:M(()=>[s("header",null,[c(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>v(l)?l.value=t:null),type:"text",class:"text-input",placeholder:"搜索"},null,512),[[w,n(l)]]),s("div",{onClick:e[3]||(e[3]=t=>n(g).open=!0)},"")]),s("div",Y,[(a(!0),u(C,null,U(n(f),t=>c((a(),R(h,{key:t.id,activity:t,onClick:st=>B(t)},null,8,["activity","onClick"])),[[J,t.title.includes(n(l))]])),128))])]),_:1},512),x(D,{ref_key:"dialog2",ref:g,height:"calc(60% - 100px)",class:"dialog2"},{default:M(()=>[e[8]||(e[8]=s("div",{class:"title"},"新活动",-1)),c(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>v(m)?m.value=t:null),type:"text",class:"text-input",placeholder:"名称"},null,512),[[w,n(m)]]),c(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>v(y)?y.value=t:null),class:"text-input",placeholder:"简介"},null,512),[[w,n(y)]]),c(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>v(o)?o.value=t:null),class:"text-input"},[(a(!0),u(C,null,U(n(r),t=>(a(),u("option",{key:t.timestamp,value:t.beStr},V(t.displayStr),9,Z))),128))],512),[[T,n(o)]]),c(s("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>v(b)?b.value=t:null),class:"text-input"},[(a(!0),u(C,null,U(n(r),t=>(a(),u("option",{key:t.timestamp,value:t.beStr},V(t.displayStr),9,tt))),128))],512),[[T,n(b)]]),s("div",{class:"button",onClick:K},"确定")]),_:1,__:[8]},512)])}}}),nt=Object.assign(F(et,[["__scopeId","data-v-4403feaa"]]),{__name:"ActivitySelector"}),lt={class:"pageRoot",style:{padding:"0 10px"}},ot=["value"],it=q({__name:"postTrip",setup(P){const k=j(14),S=i(""),r=i(k[0]?.beStr),d=i("");function _(){const p=N().waiting();new $("/api/trip").post({activity_id:S.value,date:r.value,text:d.value,is_public:!1}).then(l=>{W().push({path:"/suggestions",query:{tripId:l.trip_id}})}).catch(()=>{N().alert("匹配失败！")}).finally(()=>{p.close()})}const f=i(null);return E(()=>{const p=Q().query.activityId;p&&new $("/api/activity/byid").get({id:p}).then(l=>{f.value.setTargetActivity(l)})}),(p,l)=>{const g=O,m=z,y=nt;return a(),u("div",lt,[x(g,{title:"添加行程"}),x(m,{style:{margin:"0 0 10px 0"}}),x(y,{ref_key:"as",ref:f,onActivityId:l[0]||(l[0]=o=>S.value=o)},null,512),c(s("select",{"onUpdate:modelValue":l[1]||(l[1]=o=>v(r)?r.value=o:null),class:"text-input"},[(a(!0),u(C,null,U(n(k),o=>(a(),u("option",{key:o.timestamp,value:o.beStr},V(o.displayStr),9,ot))),128))],512),[[T,n(r)]]),c(s("textarea",{"onUpdate:modelValue":l[2]||(l[2]=o=>v(d)?d.value=o:null),class:"text-input",placeholder:"自我介绍 / 对搭子的要求"},null,512),[[w,n(d)]]),s("div",{class:"button",onClick:_},"匹配搭子")])}}}),mt=F(it,[["__scopeId","data-v-53e72a39"]]);export{mt as default};
